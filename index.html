<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 24px;
      background: #f5f5f5;
      color: #222;
    }
    .card {
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      text-align: center;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px;
    }
    p {
      font-size: 14px;
      margin: 4px 0;
      color: #555;
    }
    .badge {
      display: inline-block;
      margin-top: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1565c0;
      font-size: 12px;
    }
    .btn {
      margin-top: 16px;
      display: inline-block;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-primary {
      background: #0288D1;
      color: #fff;
    }
    .btn-secondary {
      background: #eeeeee;
      color: #424242;
    }
    .small {
      font-size: 12px;
      color: #999;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ä‡∏£‡πå‚Ä¶</h1>
    <p id="statusText">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
    <div class="badge" id="orderBadge" style="display:none;"></div>

    <button id="shareBtn" class="btn btn-primary" style="display:none;">
      üîÅ ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    </button>

    <button id="closeBtn" class="btn btn-secondary" style="display:none;">
      ‚úñ ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
    </button>

    <p class="small" id="hintText"></p>
  </div>

  <script>
    // *** ‡∏ï‡∏±‡πâ‡∏á LIFF ID ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ***
    const LIFF_ID = "1657584857-XB5b5YAD";

    // ‡∏≠‡πà‡∏≤‡∏ô query string ‡∏à‡∏≤‡∏Å URL ?orderId=...&name=...&folderUrl=...
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        orderId: params.get("orderId")   || "-",
        name: params.get("name")         || "-",
        folderUrl: params.get("folderUrl") || ""
      };
    }

    async function main() {
      const statusEl = document.getElementById("statusText");
      const badgeEl  = document.getElementById("orderBadge");
      const shareBtn = document.getElementById("shareBtn");
      const closeBtn = document.getElementById("closeBtn");
      const hintText = document.getElementById("hintText");

      const qp = getQueryParams();

      // ‡πÅ‡∏™‡∏î‡∏á Order ID ‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô
      if (qp.orderId && qp.orderId !== "-") {
        badgeEl.textContent = "Order ID: " + qp.orderId;
        badgeEl.style.display = "inline-block";
      }

      try {
        statusEl.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE‚Ä¶";

        await liff.init({ liffId: LIFF_ID });

        if (!liff.isInClient()) {
          statusEl.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)";
          hintText.textContent = "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà ‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥";
          closeBtn.style.display = "inline-block";
          closeBtn.onclick = () => window.close();
          return;
        }

        if (!liff.isApiAvailable("shareTargetPicker")) {
          statusEl.textContent = "‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô LINE ‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ shareTargetPicker ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
          hintText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏≠‡∏õ LINE ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
          closeBtn.style.display = "inline-block";
          closeBtn.onclick = () => liff.closeWindow();
          return;
        }

        statusEl.textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚ú®";
        hintText.textContent = "‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ä‡∏ó‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏™‡πà‡∏á";

        shareBtn.style.display = "inline-block";
        closeBtn.style.display = "inline-block";

        shareBtn.onclick = async () => {
          try {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Bubble ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
            const bubble = {
              type: "bubble",
              size: "mega",
              body: {
                type: "box",
                layout: "vertical",
                contents: [
                  {
                    type: "text",
                    text: "üéâ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞/‡∏Ñ‡∏£‡∏±‡∏ö",
                    weight: "bold",
                    size: "lg",
                    wrap: true
                  },
                  {
                    type: "text",
                    text: "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: " + (qp.orderId || "-"),
                    size: "sm",
                    margin: "md",
                    wrap: true
                  },
                  {
                    type: "text",
                    text: "‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: " + (qp.name || "-"),
                    size: "sm",
                    wrap: true
                  },
                  {
                    type: "separator",
                    margin: "md"
                  },
                  {
                    type: "text",
                    text: "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ üòä",
                    size: "sm",
                    wrap: true,
                    margin: "md"
                  }
                ]
              },
              footer: {
                type: "box",
                layout: "vertical",
                spacing: "sm",
                contents: [
                  {
                    type: "button",
                    style: "primary",
                    color: "#2E7D32",
                    action: {
                      type: "uri",
                      label: "üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
                      uri: qp.folderUrl || "https://lin.ee/4SFfzp3"
                    }
                  }
                ]
              }
            };

            await liff.shareTargetPicker([
              {
                type: "flex",
                altText: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ " + (qp.orderId || ""),
                contents: bubble
              }
            ]);

            statusEl.textContent = "‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";
            hintText.textContent = "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞/‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢";
            liff.closeWindow();

          } catch (err) {
            console.error(err);
            statusEl.textContent = "‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå";
            hintText.textContent = String(err);
          }
        };

        closeBtn.onclick = () => liff.closeWindow();

      } catch (err) {
        console.error(err);
        statusEl.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î LIFF";
        hintText.textContent = String(err);
        closeBtn.style.display = "inline-block";
        closeBtn.onclick = () => window.close();
      }
    }

    main();
  </script>
</body>
</html>
